const questions = [

/* ================= QUANTITATIVE ================= */

{
q:"If the sum of two numbers is 120 and their HCF is 12, how many such pairs exist?",
options:["3","4","5","6"],
correct:1
},
{
q:"A number when divided by 296 leaves remainder 75. What remainder when divided by 37?",
options:["1","2","3","4"],
correct:1
},
{
q:"The difference between CI and SI on ₹8000 for 2 years at 10% is:",
options:["60","70","80","90"],
correct:2
},
{
q:"If log2(x) + log2(x-2) = 3, find x.",
options:["2","4","6","8"],
correct:1
},
{
q:"A train 200m crosses another 300m train in opposite direction in 10s. Speed of faster train if slower is 54 km/h?",
options:["72","90","108","126"],
correct:3
},
{
q:"Find next: 2,5,11,23,47,?",
options:["91","95","97","99"],
correct:1
},
{
q:"If a:b = 4:5, b:c = 6:7, find a:c.",
options:["12:35","24:35","20:21","30:49"],
correct:1
},
{
q:"A can do work in 8 days, B in 12 days. After 2 days A leaves. Remaining time?",
options:["6","7","8","9"],
correct:2
},
{
q:"Find the smallest number divisible by 8,12,15 leaving remainder 5.",
options:["115","120","125","245"],
correct:3
},
{
q:"If sinθ = 3/5, find cosθ.",
options:["4/5","5/4","3/4","2/5"],
correct:0
},
{
q:"Average of 20 numbers is 50. One number 100 replaced by 40. New average?",
options:["46","47","48","49"],
correct:1
},
{
q:"A man sells at 20% loss. Had he sold for ₹120 more, gain 10%. Find CP.",
options:["400","480","500","600"],
correct:1
},
{
q:"If 5^(x+1) = 125, find x.",
options:["1","2","3","4"],
correct:1
},
{
q:"Probability of getting at least one head in two coin tosses?",
options:["1/2","3/4","1/4","2/3"],
correct:1
},
{
q:"Find missing: 4,18,48,100,?",
options:["150","168","180","196"],
correct:2
},
{
q:"Boat speed 10 km/h, stream 4 km/h. Upstream speed?",
options:["4","5","6","7"],
correct:2
},
{
q:"If x² - 5x + 6 = 0, find x.",
options:["2 or 3","1 or 6","-2 or -3","None"],
correct:0
},
{
q:"Find area of triangle with sides 5,12,13.",
options:["20","30","40","60"],
correct:1
},
{
q:"Simple interest on ₹5000 for 3 yrs is ₹1500. Rate?",
options:["8%","10%","12%","15%"],
correct:1
},
{
q:"Find next: 1,1,2,6,24,120,?",
options:["240","360","600","720"],
correct:3
},

/* ================= LOGICAL ================= */

{
q:"Five people sit in a row. A is left of B but right of C. D is right of B. Who is in middle?",
options:["A","B","C","Cannot determine"],
correct:0
},
{
q:"Mirror time is 6:20. Actual time?",
options:["5:40","6:40","7:40","8:40"],
correct:0
},
{
q:"Odd pair:",
options:["Square-4","Pentagon-5","Triangle-4","Hexagon-6"],
correct:2
},
{
q:"If FLOWER coded as GMPXFS, TREE?",
options:["USFF","USGF","USFFS","VSGG"],
correct:0
},
{
q:"Statements: Some cars are bikes. All bikes are buses. Conclusion?",
options:["Some cars are buses","All cars buses","No cars buses","Cannot say"],
correct:0
},
{
q:"Find next: AB, DEF, HIJK, MNOPQ, ?",
options:["RSTUV","TUVWX","STUVW","UVWXY"],
correct:2
},
{
q:"A walks 10m east, 10m north, 10m west. Distance from start?",
options:["0","10","20","30"],
correct:1
},
{
q:"How many triangles in a hexagon formed by diagonals?",
options:["18","20","24","32"],
correct:2
},
{
q:"If yesterday was 2 days before Monday, today?",
options:["Saturday","Sunday","Friday","Thursday"],
correct:0
},
{
q:"Choose odd word:",
options:["Lion","Tiger","Leopard","Elephant"],
correct:3
},
{
q:"If CAT = 3120, DOG = 4157, RAT = ?",
options:["1820","18120","1819","1920"],
correct:1
},
{
q:"Cube painted all sides then cut into 27 cubes. How many have exactly 2 faces painted?",
options:["8","12","16","20"],
correct:1
},
{
q:"Find missing: 6,13,28,59,?",
options:["90","110","122","121"],
correct:2
},
{
q:"Pointing to woman, 'She is mother of my father's daughter.' Who?",
options:["Sister","Mother","Daughter","Wife"],
correct:3
},
{
q:"Find next: Z1, X2, V3, T4,?",
options:["R5","S5","Q5","P5"],
correct:0
},
{
q:"If '+' means '-', evaluate 10 + 5.",
options:["15","5","-5","0"],
correct:1
},
{
q:"All apples fruits. Some fruits sweet. Conclusion?",
options:["Some apples sweet","All apples sweet","Cannot determine","No apples sweet"],
correct:2
},
{
q:"Arrange: Graduation, Job, Promotion, Retirement.",
options:["1,2,3,4","2,1,3,4","1,3,2,4","1,2,4,3"],
correct:0
},
{
q:"How many rectangles in 3x2 grid?",
options:["12","15","18","20"],
correct:2
},
{
q:"Find next: 11,121,1331,?",
options:["14641","16161","15151","17171"],
correct:0
},

/* ================= ENGLISH ================= */

{
q:"Synonym of EPHEMERAL:",
options:["Permanent","Short-lived","Colorful","Strong"],
correct:1
},
{
q:"Antonym of BENEVOLENT:",
options:["Kind","Cruel","Generous","Polite"],
correct:1
},
{
q:"Choose correct: Neither of the boys ___ present.",
options:["are","were","is","have"],
correct:2
},
{
q:"Meaning of 'hit the sack':",
options:["Work hard","Go to sleep","Get angry","Celebrate"],
correct:1
},
{
q:"Correct spelling:",
options:["Conscience","Concience","Conscince","Consciense"],
correct:0
},
{
q:"One word: Study of earthquakes.",
options:["Biology","Seismology","Geology","Astrology"],
correct:1
},
{
q:"Fill blank: She is superior ___ me.",
options:["than","to","from","over"],
correct:1
},
{
q:"Synonym of PRUDENT:",
options:["Careless","Wise","Lazy","Angry"],
correct:1
},
{
q:"Antonym of VIVID:",
options:["Bright","Dull","Clear","Lively"],
correct:1
},
{
q:"Choose correct sentence:",
options:["He has went home.","He has gone home.","He gone home.","He going home."],
correct:1
},
{
q:"Passage: Automation increases efficiency but may reduce employment. What is the concern?",
options:["Higher salary","Job loss","Better machines","Less training"],
correct:1
},
{
q:"Passage: Innovation drives economic growth. What drives growth?",
options:["Taxes","Innovation","Imports","Population"],
correct:1
},
{
q:"Passage: Excess sugar leads to health risks. Risk source?",
options:["Salt","Sugar","Water","Exercise"],
correct:1
},
{
q:"Passage: Reading improves vocabulary and comprehension. Benefit?",
options:["Sleep","Better vocabulary","Noise","Stress"],
correct:1
},
{
q:"Synonym of OBFUSCATE:",
options:["Clarify","Confuse","Explain","Reveal"],
correct:1
},
{
q:"Antonym of RESILIENT:",
options:["Flexible","Fragile","Strong","Elastic"],
correct:1
},
{
q:"Fill blank: He insisted ___ paying.",
options:["on","for","to","at"],
correct:0
},
{
q:"Meaning of 'burn the midnight oil':",
options:["Waste fuel","Study late","Cook food","Travel"],
correct:1
},
{
q:"Article: ___ MBA graduate.",
options:["A","An","The","None"],
correct:0
},
{
q:"Plural of CRITERION:",
options:["Criterions","Criteria","Criterion","Criterias"],
correct:1
}

];


let currentQuestion = 0;
let userAnswers = new Array(questions.length).fill(null);
let markedQuestions = new Set();
let timeLeft = 60 * 60; // 60 minutes in seconds
let timerInterval;
let violations = 0;
let examStarted = false;
let isFullscreen = false;

// Enable start button when checkbox is checked
document.addEventListener('DOMContentLoaded', function() {
    const agreeCheckbox = document.getElementById('agreeCheckbox');
    const startExamBtn = document.getElementById('startExamBtn');
    
    if (agreeCheckbox && startExamBtn) {
        agreeCheckbox.addEventListener('change', function() {
            startExamBtn.disabled = !this.checked;
        });
    }
});

// Start exam function
function startExam() {
    // Hide start screen
    document.getElementById('startScreen').classList.add('hidden');
    
    // Show quiz interface
    document.getElementById('quizInterface').classList.remove('hidden');
    
    // Enter fullscreen
    enterFullscreen();
    
    // Mark exam as started
    examStarted = true;
    
    // Initialize quiz
    init();
}

// Enter fullscreen mode
function enterFullscreen() {
    const elem = document.documentElement;
    
    if (elem.requestFullscreen) {
        elem.requestFullscreen().catch(err => {
            console.log('Fullscreen error:', err);
        });
    } else if (elem.webkitRequestFullscreen) { /* Safari */
        elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) { /* IE11 */
        elem.msRequestFullscreen();
    }
    
    isFullscreen = true;
}

// Exit fullscreen (only for results)
function exitFullscreen() {
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.webkitExitFullscreen) { /* Safari */
        document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) { /* IE11 */
        document.msExitFullscreen();
    }
    
    isFullscreen = false;
}

// Show warning overlay
function showWarning(message) {
    violations++;
    document.getElementById('warningMessage').innerText = message;
    document.getElementById('violationCount').innerText = violations;
    document.getElementById('warningOverlay').classList.remove('hidden');
    
    // Log violation (in a real system, this would be sent to server)
    console.log(`Violation ${violations}: ${message}`);
}

// Dismiss warning
function dismissWarning() {
    document.getElementById('warningOverlay').classList.add('hidden');
    
    // Re-enter fullscreen
    if (examStarted && !document.getElementById('resultsContainer').classList.contains('hidden') === false) {
        enterFullscreen();
    }
}

// Monitor fullscreen changes
document.addEventListener('fullscreenchange', function() {
    if (examStarted && !document.fullscreenElement && !document.getElementById('resultsContainer').classList.contains('hidden') === false) {
        showWarning('You exited fullscreen mode! Please stay in fullscreen.');
        isFullscreen = false;
    } else if (document.fullscreenElement) {
        isFullscreen = true;
    }
});

// Webkit fullscreen change (Safari)
document.addEventListener('webkitfullscreenchange', function() {
    if (examStarted && !document.webkitFullscreenElement && !document.getElementById('resultsContainer').classList.contains('hidden') === false) {
        showWarning('You exited fullscreen mode! Please stay in fullscreen.');
        isFullscreen = false;
    } else if (document.webkitFullscreenElement) {
        isFullscreen = true;
    }
});

// Detect tab switching (visibility change)
document.addEventListener('visibilitychange', function() {
    if (examStarted && document.hidden && !document.getElementById('resultsContainer').classList.contains('hidden') === false) {
        showWarning('You switched tabs or minimized the window!');
    }
});

// Detect window blur (switching to another application)
window.addEventListener('blur', function() {
    if (examStarted && !document.getElementById('resultsContainer').classList.contains('hidden') === false) {
        showWarning('You switched to another application!');
    }
});

// Prevent right-click during exam
document.addEventListener('contextmenu', function(e) {
    if (examStarted && !document.getElementById('resultsContainer').classList.contains('hidden') === false) {
        e.preventDefault();
        showWarning('Right-click is disabled during the exam!');
    }
});

// Detect problematic key combinations
document.addEventListener('keydown', function(e) {
    if (!examStarted || !document.getElementById('resultsContainer').classList.contains('hidden')) {
        return;
    }
    
    // Block Escape key
    if (e.key === 'Escape') {
        e.preventDefault();
        showWarning('Escape key is disabled during the exam!');
    }
    
    // Block Alt+Tab, Windows key, F11, etc.
    if (e.altKey && e.key === 'Tab') {
        e.preventDefault();
        showWarning('Alt+Tab is disabled during the exam!');
    }
    
    // Block Windows/Command key
    if (e.key === 'Meta' || e.metaKey) {
        e.preventDefault();
        showWarning('Windows/Command key is disabled during the exam!');
    }
    
    // Block F keys (except F5 for refresh)
    if (e.key.startsWith('F') && e.key !== 'F5') {
        e.preventDefault();
        showWarning('Function keys are disabled during the exam!');
    }
    
    // Block Ctrl+W (close tab)
    if (e.ctrlKey && (e.key === 'w' || e.key === 'W')) {
        e.preventDefault();
        showWarning('Closing the tab is not allowed during the exam!');
    }
    
    // Block Ctrl+Shift+I (DevTools)
    if (e.ctrlKey && e.shiftKey && (e.key === 'i' || e.key === 'I')) {
        e.preventDefault();
        showWarning('Developer tools are disabled during the exam!');
    }
    
    // Block Ctrl+U (view source)
    if (e.ctrlKey && (e.key === 'u' || e.key === 'U')) {
        e.preventDefault();
        showWarning('Viewing page source is disabled during the exam!');
    }
});

// Initialize the quiz
function init() {
    renderQuestion();
    renderPalette();
    startTimer();
    updateProgress();
    
    // Add keyboard navigation
    document.addEventListener('keydown', handleKeyPress);
}

// Keyboard navigation
function handleKeyPress(e) {
    if (!examStarted) return;
    
    if (e.key === 'ArrowLeft' && currentQuestion > 0) {
        previousQuestion();
    } else if (e.key === 'ArrowRight' && currentQuestion < questions.length - 1) {
        nextQuestion();
    } else if (e.key >= '1' && e.key <= '4') {
        const optionIndex = parseInt(e.key) - 1;
        if (optionIndex < questions[currentQuestion].options.length) {
            selectOption(optionIndex);
        }
    }
}

// Render current question
function renderQuestion() {
    const q = questions[currentQuestion];
    
    // Update question header
    document.getElementById('questionNumber').innerText = `Question ${currentQuestion + 1} of ${questions.length}`;
    document.getElementById('questionNumberIcon').innerText = currentQuestion + 1;
    document.getElementById('currentNum').innerText = currentQuestion + 1;
    document.getElementById('totalNum').innerText = questions.length;
    document.getElementById('questionText').innerText = q.q;
    
    // Render options
    const container = document.getElementById('optionsContainer');
    container.innerHTML = '';
    
    q.options.forEach((opt, idx) => {
        const isSelected = userAnswers[currentQuestion] === idx;
        const optionLetter = String.fromCharCode(65 + idx);
        
        const btn = document.createElement('button');
        btn.className = `w-full p-5 rounded-2xl border-2 text-left transition-all font-medium option-hover ${
            isSelected 
            ? 'border-indigo-600 bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700 ring-4 ring-indigo-100 shadow-lg' 
            : 'border-slate-200 hover:border-indigo-300 bg-white text-slate-700'
        }`;
        
        btn.innerHTML = `
            <div class="flex items-center gap-4">
                <span class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-xl font-bold text-sm ${
                    isSelected 
                    ? 'bg-gradient-to-br from-indigo-500 to-purple-600 text-white shadow-md' 
                    : 'bg-slate-100 text-slate-600'
                }">
                    ${optionLetter}
                </span>
                <span class="flex-1">${opt}</span>
                ${isSelected ? `
                    <svg class="w-6 h-6 text-indigo-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                ` : ''}
            </div>
        `;
        
        btn.onclick = () => selectOption(idx);
        container.appendChild(btn);
        
        // Add animation delay
        btn.style.animationDelay = `${idx * 0.05}s`;
        btn.classList.add('animate-fade-in');
    });

    // Update navigation buttons
    const previousBtn = document.getElementById('previousBtn');
    previousBtn.disabled = currentQuestion === 0;
    
    const nextBtn = document.getElementById('nextBtn');
    const nextBtnText = document.getElementById('nextBtnText');
    if (currentQuestion === questions.length - 1) {
        nextBtnText.innerText = 'Review & Submit';
    } else {
        nextBtnText.innerText = 'Next';
    }
    
    // Update mark button
    updateMarkButton();
    
    // Update progress
    updateProgress();
}

// Select an option
function selectOption(idx) {
    userAnswers[currentQuestion] = idx;
    renderQuestion();
    renderPalette();
}

// Toggle mark for review
function toggleMark() {
    if (markedQuestions.has(currentQuestion)) {
        markedQuestions.delete(currentQuestion);
    } else {
        markedQuestions.add(currentQuestion);
    }
    updateMarkButton();
    renderPalette();
}

// Update mark button appearance
function updateMarkButton() {
    const markBtn = document.getElementById('markBtn');
    const markText = document.getElementById('markText');
    
    if (markedQuestions.has(currentQuestion)) {
        markBtn.classList.add('bg-amber-500/30', 'text-amber-100');
        markText.innerText = 'Marked';
    } else {
        markBtn.classList.remove('bg-amber-500/30', 'text-amber-100');
        markText.innerText = 'Mark';
    }
}

// Render question palette
function renderPalette() {
    const grid = document.getElementById('questionGrid');
    grid.innerHTML = '';
    
    let answered = 0;
    
    questions.forEach((_, i) => {
        const isCurrent = i === currentQuestion;
        const isAnswered = userAnswers[i] !== null;
        const isMarked = markedQuestions.has(i);
        
        if (isAnswered) answered++;

        const btn = document.createElement('button');
        btn.className = `h-11 w-11 rounded-xl font-bold text-sm transition-all border-2 palette-btn ${
            isCurrent ? 'ring-4 ring-offset-2 ring-indigo-400 scale-110 z-10' : ''
        } ${
            isMarked ? 'bg-gradient-to-br from-amber-400 to-orange-500 text-white border-amber-500 shadow-md' :
            isAnswered ? 'bg-gradient-to-br from-green-400 to-emerald-500 text-white border-green-500 shadow-md' : 
            'bg-white text-slate-500 border-slate-300 hover:border-slate-400'
        }`;
        
        btn.innerText = i + 1;
        btn.onclick = () => { 
            currentQuestion = i; 
            renderQuestion(); 
        };
        
        // Add tooltip
        btn.title = isMarked ? 'Marked for review' : isAnswered ? 'Answered' : 'Not visited';
        
        grid.appendChild(btn);
    });

    // Update statistics
    document.getElementById('answeredCount').innerText = answered;
    document.getElementById('markedCount').innerText = markedQuestions.size;
    document.getElementById('remainingCount').innerText = questions.length - answered;
}

// Update progress bar
function updateProgress() {
    const answered = userAnswers.filter(ans => ans !== null).length;
    const progress = (answered / questions.length) * 100;
    document.getElementById('progressBar').style.width = `${progress}%`;
}

// Navigate to next question
function nextQuestion() {
    if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        renderQuestion();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    } else {
        // Show confirmation before submitting
        const unanswered = userAnswers.filter(ans => ans === null).length;
        if (unanswered > 0) {
            const confirmSubmit = confirm(`You have ${unanswered} unanswered question(s). Do you want to submit the test?`);
            if (confirmSubmit) {
                submitQuiz();
            }
        } else {
            submitQuiz();
        }
    }
}

// Navigate to previous question
function previousQuestion() {
    if (currentQuestion > 0) {
        currentQuestion--;
        renderQuestion();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

// Start the timer
function startTimer() {
    const timerDisplay = document.getElementById('timer');
    const timerCard = document.getElementById('timerCard');
    
    timerInterval = setInterval(() => {
        let mins = Math.floor(timeLeft / 60);
        let secs = timeLeft % 60;
        timerDisplay.innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        
        // Add warning styling when time is running low (last 5 minutes)
        if (timeLeft <= 300 && timeLeft > 0) {
            timerCard.classList.add('timer-warning');
        }
        
        // Auto-submit when time runs out
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            alert('Time is up! Your test will be submitted automatically.');
            submitQuiz();
        }
        
        timeLeft--;
    }, 1000);
}

// Submit the quiz
function submitQuiz() {
    // Mark exam as ended
    examStarted = false;
    
    // Clear the timer
    clearInterval(timerInterval);
    
    let correct = 0;
    let incorrect = 0;
    let skipped = 0;
    
    const reviewList = document.getElementById('answersList');
    reviewList.innerHTML = '';

    // Calculate results
    questions.forEach((q, i) => {
        const uAns = userAnswers[i];
        const item = document.createElement('div');
        item.className = 'p-5 rounded-2xl border-2 transition-all hover:shadow-md';
        
        if (uAns === null) {
            skipped++;
            item.classList.add('bg-slate-50', 'border-slate-200');
            item.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-slate-400 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                        ${i + 1}
                    </div>
                    <div class="flex-1">
                        <p class="font-semibold text-slate-800 mb-2">${q.q}</p>
                        <p class="text-sm text-slate-500 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                            </svg>
                            Not Attempted
                        </p>
                        <p class="text-sm text-green-600 font-semibold mt-1">Correct Answer: ${q.options[q.correct]}</p>
                    </div>
                </div>
            `;
        } else if (uAns === q.correct) {
            correct++;
            item.classList.add('bg-green-50', 'border-green-200');
            item.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                        ${i + 1}
                    </div>
                    <div class="flex-1">
                        <p class="font-semibold text-slate-800 mb-2">${q.q}</p>
                        <p class="text-sm text-green-700 font-bold flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            Correct: ${q.options[q.correct]}
                        </p>
                    </div>
                </div>
            `;
        } else {
            incorrect++;
            item.classList.add('bg-red-50', 'border-red-200');
            item.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-red-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                        ${i + 1}
                    </div>
                    <div class="flex-1">
                        <p class="font-semibold text-slate-800 mb-2">${q.q}</p>
                        <p class="text-sm text-red-700 font-bold flex items-center gap-2 mb-1">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                            </svg>
                            Your Answer: ${q.options[uAns]}
                        </p>
                        <p class="text-sm text-green-600 font-semibold">Correct Answer: ${q.options[q.correct]}</p>
                    </div>
                </div>
            `;
        }
        
        reviewList.appendChild(item);
    });

    // Update score display
    const percentage = Math.round((correct / questions.length) * 100);
    document.getElementById('scoreNumber').innerText = correct;
    document.getElementById('percentage').innerText = `${percentage}% Accuracy`;
    document.getElementById('correctCount').innerText = correct;
    document.getElementById('incorrectCount').innerText = incorrect;
    document.getElementById('unattemptedCount').innerText = skipped;
    
    // Animate the circular progress
    const circumference = 2 * Math.PI * 88;
    const offset = circumference - (percentage / 100) * circumference;
    setTimeout(() => {
        document.getElementById('scoreCircle').style.strokeDashoffset = offset;
    }, 100);
    
    // Exit fullscreen before showing results
    exitFullscreen();
    
    // Show results modal
    document.getElementById('resultsContainer').classList.remove('hidden');
    
    // Scroll to top of results
    document.getElementById('resultsContainer').scrollTop = 0;
}

// Prevent accidental page refresh during exam
window.addEventListener('beforeunload', function (e) {
    if (examStarted && document.getElementById('resultsContainer').classList.contains('hidden')) {
        e.preventDefault();
        e.returnValue = 'Are you sure you want to leave? Your exam progress will be lost.';
        return e.returnValue;
    }
});